{% extends "base.html" %}

{% block title %}{{ entity_id }}{% endblock %}

{% block content %}
<h2 style="color:#fff; text-shadow:0 0 6px #0f0;">{{ entity_id }}</h2>

<div class="container">
  <!-- Lifetime Balance -->
  <div class="balance-card">
    <h3>Historical Balance</h3>
    <p class="harm">Lifetime Harm (LY): <span>{{ "%.1f"|format(balance.harm_ly / 1000000) }} million</span></p>
    <p class="harm">Lifetime Harm (ECY): <span>{{ "%.1f"|format(balance.harm_ecy / 1000000) }} million</span></p>
    <p class="surplus">Lifetime Surplus (LY): <span>{{ "%.1f"|format(balance.surplus_ly / 1000000) }} million</span></p>
    <p class="surplus">Lifetime Surplus (ECY): <span>{{ "%.1f"|format(balance.surplus_ecy / 1000000) }} million</span></p>
    <p class="harm">Outstanding LY: <span>{{ "%.1f"|format(balance.outstanding_ly / 1000000) }} million</span></p>
    <p class="harm">Outstanding ECY: <span>{{ "%.1f"|format(balance.outstanding_ecy / 1000000) }} million</span></p>
    <p class="neutral">Status: <strong>{{ balance.status.value }}</strong></p>
  </div>

  <!-- Annual Balance -->
  {% if annual %}
  <div class="balance-card">
    <h3>Annual Balance ({{ annual.year }})</h3>
    <p class="harm">Harm (LY): <span>{{ "%.1f"|format(annual.harm_ly / 1000000) }} million</span></p>
    <p class="harm">Harm (ECY): <span>{{ "%.1f"|format(annual.harm_ecy / 1000000) }} million</span></p>
    <p class="surplus">Surplus (LY): <span>{{ "%.1f"|format(annual.surplus_ly / 1000000) }} million</span></p>
    <p class="surplus">Surplus (ECY): <span>{{ "%.1f"|format(annual.surplus_ecy / 1000000) }} million</span></p>
    <p class="neutral">Status: <strong>{{ annual.status.value }}</strong></p>
  </div>
  {% endif %}

  <!-- Harm Breakdown -->
  {% if harm_types %}
  <div class="balance-card">
    <h3>Harm Breakdown (By Intent Type)</h3>
    <ul style="margin-left:1.5rem; list-style-type:square;">
      {% for htype, data in harm_types.items() %}
        <li>
          <strong>{{ htype }}</strong> ({{ data.count }} entries): 
          <span class="harm">{{ "%.1f"|format(data.ly / 1000000) }} million LY</span> | 
          <span class="harm">{{ "%.1f"|format(data.ecy / 1000000) }} million ECY</span>
        </li>
      {% endfor %}
    </ul>
  </div>
  {% endif %}

  <!-- Entries by Harm Type -->
  <h3 style="margin-top:1.5rem;">Entries by Harm Type</h3>
  {% for htype, ents in entries_by_type.items() %}
    <div class="balance-card">
      <h4 style="color:#33ff33;">{{ htype }} ({{ ents|length }} entries)</h4>
      <ul style="margin-left:1.5rem; list-style-type:disc;">
        {% for entry in ents %}
          <li><strong>{{ entry.year }}</strong>: {{ entry.description }}</li>
        {% endfor %}
      </ul>
    </div>
  {% endfor %}
</div>

<p><a href="/" style="color:#33ff33; text-decoration:none;">‚Üê Back</a></p>
{% endblock %}

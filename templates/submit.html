{% extends "base.html" %}

{% block title %}Submit Entry{% endblock %}

{% block content %}
<h2>Submit a entry</h2>

<div class="container">
  <form id="submitForm" class="form-grid">
    <!-- Entity Info -->
    <fieldset>
      <legend>Entity Information</legend>
      <div class="form-group">
        <label for="entity_id">Entity ID</label>
        <input type="text" id="entity_id" name="entity_id" required>
      </div>
      <div class="form-group">
        <label for="year">Year</label>
        <input type="number" id="year" name="year" required>
      </div>
    </fieldset>

    <!-- Narrative -->
    <fieldset>
      <legend>Description of Event</legend>
      <div class="form-group">
        <label for="description">What happened?</label>
        <textarea id="description" name="description" required></textarea>
      </div>
    </fieldset>

    <!-- Classification -->
    <fieldset>
      <legend>Classification</legend>
      <div class="form-group">
        <label for="harm_type">Type of Harm</label>
        <select id="harm_type" name="harm_type">
          {% for ht in harm_types %}
            <option value="{{ ht }}">{{ ht }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="form-group">
        <label for="confidence">Confidence Level</label>
        <select id="confidence" name="confidence">
          <option value="LOW">Low</option>
          <option value="MEDIUM" selected>Medium</option>
          <option value="HIGH">High</option>
        </select>
      </div>
    </fieldset>

    <!-- Contribution -->
    <fieldset>
      <legend>Positive Contribution (optional)</legend>
      <div class="form-group">
        <label for="contribution">Contribution Type</label>
        <select id="contribution" name="contribution">
          <option value="">-- None --</option>
          <option value="Healthcare">Healthcare</option>
          <option value="Education">Education</option>
          <option value="Humanitarian Aid">Humanitarian Aid</option>
          <option value="Other">Other</option>
        </select>
      </div>
    </fieldset>

    <button type="submit" class="btn-submit">Submit Entry</button>
  </form>

  <div id="result"></div>
</div>

<style>
  .form-grid { display: flex; flex-direction: column; gap: 1.5rem; }
  fieldset { border: 1px solid #ccc; padding: 1rem; border-radius: 6px; }
  legend { font-weight: bold; margin-bottom: .5rem; }
  .form-group { display: flex; flex-direction: column; margin-bottom: .75rem; }
  label { font-weight: 600; margin-bottom: .25rem; }
  input, textarea, select { padding: .5rem; border: 1px solid #ccc; border-radius: 4px; }
  .btn-submit { padding: .75rem 1.5rem; background-color: #2c3e50; color: #fff; border: none; border-radius: 6px; cursor: pointer; font-size: 1rem; }
  .btn-submit:hover { background-color: #1a252f; }
</style>

<script>
document.getElementById("submitForm").onsubmit = async (e) => {
  e.preventDefault();
  const data = Object.fromEntries(new FormData(e.target));

  const res = await fetch("/submit", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify(data)
  });

  const json = await res.json();
  if (json.success) {
    document.getElementById("result").innerHTML = `<p style="color:green">Entry submitted successfully! ID: ${json.entry_id}</p>`;
  } else {
    document.getElementById("result").innerHTML = `<p style="color:red">Error: ${json.error}</p>`;
  }
};
</script>
{% endblock %}
